@namespace BlazorServerLASViewer.Domains.Well

@inject IJSRuntime JSRuntime;
@inject MainViewModel MainViewModel;

<style>
       LogSvg {
            background:rgb(255, 255, 255);
            height:@Log.SvgViewRectangle.Height;
            width:@Log.SvgViewRectangle.Width;
        }
</style>

<g id="@($"LogGroup{Log.SvgViewRectangle.RectangleId}")">

    <rect style="height:@Log.SvgViewRectangle.Height;width:@Log.SvgViewRectangle.Width;fill:rgb(@Log.SvgViewRectangle.R,@Log.SvgViewRectangle.G,@Log.SvgViewRectangle.B);cursor:pointer;stroke-width:3;stroke:rgb(0,0,0)"
          @onmousemove="MouseMove"
          @onmousedown="MouseDown"
          @onmouseup="MouseUp"
          @onmouseout="MouseOut"
          x="@Log.SvgViewRectangle.X"
          y="@Log.SvgViewRectangle.Y" />

    <text style="pointer-events: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none;  user-select: none;"
          x="@(Log.SvgViewRectangle.X + 4)"
          y="@(Log.SvgViewRectangle.Y + 20)"
          fill="black">@Log.SvgViewRectangle.Position</text>

    </g>


    @code {

        [Parameter]
        public Log<double> Log { get; set; }

        [Parameter]
        public Action<string> ChangeSelected { get; set; }

        [Parameter]
        public string pointer { get; set; } = "pointer";

        public void MouseDown(MouseEventArgs e)
        {
            if (MainViewModel.SelectedItem == -1)
            {
                Log.SvgViewRectangle.OriginalX = (int)e.ClientX - Log.SvgViewRectangle.X - MainViewModel.ContainerX;
                Log.SvgViewRectangle.OriginalY = (int)e.ClientY - Log.SvgViewRectangle.Y - MainViewModel.ContainerY;

                MainViewModel.SelectedItem = Log.SvgViewRectangle.RectangleId;
                ChangeSelected?.Invoke($"LogGroup{Log.SvgViewRectangle.RectangleId}");
            }
        }

        public void MouseUp(MouseEventArgs args)
        {
            if (MainViewModel.SelectedItem == Log.SvgViewRectangle.RectangleId)
            {
                MainViewModel.SelectedItem = -1;
            }
        }

        public void MouseOut(MouseEventArgs e)
        {
            MainViewModel.OverChild = false;
        }

        public void MouseMove(MouseEventArgs e)
        {
            MainViewModel.OverChild = true;
        }

    }
